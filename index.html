<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>chat</title>
  <link rel="icon" type="image/png" href="/m√≠dias/favicon/an√¥nimato e conex√£o com redes criptografadas para mensagens, fundo preto, detalhes em branco, estilo minimalista, logo de um s√≠mbolo.png.jpg">
  
</head>
<style>
  * {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
   font-family: sans-serif;
}

body {
   background-color: #000000;
   color: #fff;
   min-height: 100vh;
   width: 100vw;
   display: flex;
   justify-content: center;
   align-items: center;
   overflow-x: hidden;
}

.chat-container {
   width: 100vw;
   max-width: 600px;
   height: 100vh;
   min-height: 100vh;
   border: 1px solid #333;
   display: flex;
   flex-direction: column;
   border-radius: 0;
   overflow: hidden;
   background-image: url('/M√≠dias/img/Fundo/1000100757-01.jpeg');
   background-size: cover;
   background-position: center;
   background-repeat: no-repeat;
   position: relative;
}

.chat-header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   padding: 10px;
   background-color: #0000008C;
   border-bottom: 1px solid #333;
   backdrop-filter: blur(8px); 
}

.chat-header p {
   font-size: 1.2rem;
   font-weight: bold;
   word-break: break-all;
}

.button-img {
   display: flex;
   gap: 10px;
}

.button-img button {
   background: none;
   border: none;
   cursor: pointer;
}

.chat-box {
   flex: 1;
   padding: 10px;
   overflow-y: auto;
   display: flex;
   flex-direction: column;
   gap: 10px;
   min-height: 0;
   max-height: 100%;
}


/* Estilizando mensagens */
.message {
    max-width: 75%;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 10px;
    font-size: 14px;
    line-height: 1.4;
    word-break: break-word;
}

.user-message {
    align-self: flex-end;
    background-color: #2C2C2C54;
    color: white;
    border-top-right-radius: 0;
    backdrop-filter: blur(8px); /* Efeito de desfoque */
}

.bot-message {
    align-self: flex-start;
    background-color: #444;
    color: white;
    border-top-left-radius: 0;
}

.chat-input {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  margin: 5px;
  border-radius: 10px;
  background-color: #000000C9; /* Cor s√≥lida sem transpar√™ncia */
  border: 1px solid #333;
  position: relative;
  backdrop-filter: blur(8px); 
}

.chat-input input[type="text"] {
   flex: 1;
   padding: 10px;
   border: 1px solid #333;
   border-radius: 8px;
   background-color: rgba(255, 255, 255, 0.05);
   color: white;
   backdrop-filter: blur(5px);
   font-size: 15px;
}

.chat-input button {
   background: none;
   border: none;
   cursor: pointer;
}

.char-limit-alert {
   position: absolute;
   top: 10px;
   left: 50%;
   transform: translateX(-50%);
   background-color: rgba(255, 0, 0, 0.1);
   color: white;
   padding: 5px 10px;
   border-radius: 5px;
   border: 1px solid #333;
   display: none;
}

@media (max-width: 600px) {
   .chat-container {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      min-height: 100vh;
   }
   
   .chat-header p {
      font-size: 1rem;
   }
}
@media (max-width: 400px) {
  .chat-header p {
    font-size: 0.9rem;
  }
  .chat-input input[type="text"] {
    font-size: 13px;
  }
}
#onlines_chat {
  position: absolute ;
  left: 1%;
  top: 0%;
  font-size: 10px ;
  color: #0BFF8E;
}

/* Adicione ao CSS (no <style>): */
/*
.msg-menu button {
  font-family: inherit;
  font-size: 14px;
}
*/
</style>

<body>
  <div id="charLimitAlert" class="char-limit-alert"></div>
  <div class="chat-container">
    <div class="chat-header">
       <p id="titulo-sala">chat</p>
       <span id="onlines_chat">online:0</span>
       <div id="status-indicator" style="width:10px;height:10px;border-radius:50%;background-color:red;margin:5px;"></div>
      <div class="button-img">
         <button onclick="parent.voltar()">
  <!-- √çcone voltar -->
  <svg width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
    <path d="M15 18l-6-6 6-6" />
  </svg>
</button>
        <button onclick="ligar()">
          <!-- √çcone Telefone -->
          <svg width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M22 16.92V19a2 2 0 0 1-2.18 2A19.77 19.77 0 0 1 3 5.18 2 2 0 0 1 5 3h2.09a2 2 0 0 1 2 1.72 13.09 13.09 0 0 0 .57 2.57 2 2 0 0 1-.45 2.11L8.1 10.91a16 16 0 0 0 5 5l1.51-1.51a2 2 0 0 1 2.11-.45 13.09 13.09 0 0 0 2.57.57 2 2 0 0 1 1.71 2z"/></svg>
        </button>
        <img id="Perfiluser" src="/M√≠dias/img/elementos/comunidade.png" alt="Perfil do Usu√°rio" width="34 ">
 
      </div>
    </div>

    <div class="chat-box" id="chatBox"></div>

    <div class="chat-input">
      <input type="text" id="messageInput" placeholder="Digite ..." onkeypress="handleKeyPress(event)">
      <input type="file" id="fileInput" hidden>
      <input type="checkbox" id="visualizacaoUnica" hidden>
      <button id="visualizacaoUnicaBtn" aria-label="Visualiza√ß√£o √∫nica" type="button" tabindex="0" style="background:none;border:none;cursor:pointer;outline:none;display:flex;align-items:center;justify-content:center;padding:0 8px;">
        <!-- SVG ser√° trocado via JS -->
        <svg id="visualizacaoUnicaIcon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </button>

      <button onclick="sendMessage()">
        <!-- √çcone Enviar -->
        <svg width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-6 20-4-9-9-4 20-7z"/></svg>
      </button>
      <button onclick="selectFile()">
        <!-- √çcone Arquivo -->
        <svg width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      </button>
      <button id="micBtn" onclick="toggleRecording(this)">
        <!-- √çcone Microfone -->
        <svg width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M12 1v22"/><path d="M5 8v2a7 7 0 0 0 14 0V8"/><rect x="9" y="2" width="6" height="11" rx="3"/></svg>
      </button>
    </div>
  </div>
<script>
  // Gera um id √∫nico para cada aba/janela
  function getAbaId() {
    let id = sessionStorage.getItem('chatAbaId');
    if (!id) {
      id = 'aba_' + Math.random().toString(36).substr(2, 9);
      sessionStorage.setItem('chatAbaId', id);
    }
    return id;
  }
  const abaId = getAbaId();

  let salaAtual = 'chat';
  const tituloSalaEl = document.getElementById('titulo-sala');
  const chatBox = document.getElementById('chatBox');
  const messageInput = document.getElementById('messageInput');

  // Detecta sala pela URL
  function getSalaFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('sala') || 'chat';
  }
  salaAtual = getSalaFromURL();
  if (tituloSalaEl) tituloSalaEl.textContent = salaAtual;

  function getMensagensSala() {
    return JSON.parse(localStorage.getItem('chat_' + salaAtual)) || [];
  }
  function salvarMensagensSala(mensagens) {
    localStorage.setItem('chat_' + salaAtual, JSON.stringify(mensagens));
  }

  // Adiciona menu de op√ß√µes ao passar o mouse em mensagens do usu√°rio
  function criarMenuMensagem(div, msg, idx) {
    // Mostra menu para todas as mensagens (n√£o s√≥ do usu√°rio)
    const menu = document.createElement('div');
    menu.className = 'msg-menu';
    menu.style.display = 'none';
    menu.style.position = 'absolute';
    menu.style.right = '-40px';
    menu.style.top = '0';
    menu.style.background = '#222';
    menu.style.border = '1px solid #444';
    menu.style.borderRadius = '6px';
    menu.style.padding = '4px 0';
    menu.style.zIndex = '10';
    menu.style.minWidth = '110px';
    menu.style.boxShadow = '0 2px 8px #000a';

    // Bot√£o Responder
    const btnResponder = document.createElement('button');
    btnResponder.textContent = 'Responder';
    btnResponder.style.display = 'block';
    btnResponder.style.width = '100%';
    btnResponder.style.background = 'none';
    btnResponder.style.border = 'none';
    btnResponder.style.color = '#0BFF8E';
    btnResponder.style.padding = '6px 12px';
    btnResponder.style.cursor = 'pointer';
    btnResponder.onmouseover = () => btnResponder.style.background = '#333';
    btnResponder.onmouseout = () => btnResponder.style.background = 'none';
    btnResponder.onclick = (e) => {
      e.stopPropagation();
      let ref = '';
      if (msg.apagada) {
        ref = '[mensagem apagada]';
      } else if (msg.tipo === 'media') {
        if (msg.mediaType === 'image') ref = '[imagem]';
        else if (msg.mediaType === 'video') ref = '[v√≠deo]';
        else if (msg.mediaType === 'audio') ref = '[√°udio]';
        else ref = '[arquivo]';
      } else {
        ref = msg.texto.length > 60 ? msg.texto.slice(0, 60) + '‚Ä¶' : msg.texto;
      }
      messageInput.value = `‚Ü© R:\n`;
      messageInput.focus();
      // Salva o √≠ndice da mensagem que est√° sendo respondida
      messageInput.setAttribute('data-responde-idx', idx);
    };
    menu.appendChild(btnResponder);

    // Bot√£o Excluir (apenas para o pr√≥prio usu√°rio)
    if (msg.abaId === abaId) {
      const btnExcluir = document.createElement('button');
      btnExcluir.textContent = 'Excluir';
      btnExcluir.style.display = 'block';
      btnExcluir.style.width = '100%';
      btnExcluir.style.background = 'none';
      btnExcluir.style.border = 'none';
      btnExcluir.style.color = '#ff4444';
      btnExcluir.style.padding = '6px 12px';
      btnExcluir.style.cursor = 'pointer';
      btnExcluir.onmouseover = () => btnExcluir.style.background = '#333';
      btnExcluir.onmouseout = () => btnExcluir.style.background = 'none';
      btnExcluir.onclick = (e) => {
        e.stopPropagation();
        const mensagens = getMensagensSala();
        if (mensagens[idx].abaId === abaId) {
          mensagens[idx].apagada = true;
          mensagens[idx].texto = '';
          salvarMensagensSala(mensagens);
          renderizarMensagens();
        }
      };
      menu.appendChild(btnExcluir);

      // Bot√£o Ocultar
      const btnOcultar = document.createElement('button');
      btnOcultar.textContent = 'Ocultar';
      btnOcultar.style.display = 'block';
      btnOcultar.style.width = '100%';
      btnOcultar.style.background = 'none';
      btnOcultar.style.border = 'none';
      btnOcultar.style.color = '#aaa';
      btnOcultar.style.padding = '6px 12px';
      btnOcultar.style.cursor = 'pointer';
      btnOcultar.onmouseover = () => btnOcultar.style.background = '#333';
      btnOcultar.onmouseout = () => btnOcultar.style.background = 'none';
      btnOcultar.onclick = (e) => {
        e.stopPropagation();
        div.style.display = 'none';
      };
      menu.appendChild(btnOcultar);

      // Bot√£o Editar
      const btnEditar = document.createElement('button');
      btnEditar.textContent = 'Editar';
      btnEditar.style.display = 'block';
      btnEditar.style.width = '100%';
      btnEditar.style.background = 'none';
      btnEditar.style.border = 'none';
      btnEditar.style.color = '#0BFF8E';
      btnEditar.style.padding = '6px 12px';
      btnEditar.style.cursor = 'pointer';
      btnEditar.onmouseover = () => btnEditar.style.background = '#333';
      btnEditar.onmouseout = () => btnEditar.style.background = 'none';
      btnEditar.onclick = (e) => {
        e.stopPropagation();
        if (msg.tipo === 'media') {
          alert('N√£o √© poss√≠vel editar m√≠dias.');
          return;
        }
        const mensagens = getMensagensSala();
        const novoTexto = prompt('Editar mensagem:', msg.texto);
        if (novoTexto !== null && novoTexto.trim() !== '') {
          mensagens[idx].texto = novoTexto;
          salvarMensagensSala(mensagens);
          renderizarMensagens();
        }
      };
      menu.appendChild(btnEditar);
    }

    div.appendChild(menu);
    div.onmouseenter = (e) => {
      menu.style.display = 'block';
      // Ajusta a posi√ß√£o para garantir 20px de dist√¢ncia
      menu.style.right = '-20px';
    };
    div.onmouseleave = () => { menu.style.display = 'none'; };
  }

  // Fun√ß√£o para gerar cor a partir do abaId
  function corPorAbaId(abaId) {
    // Gera um hash num√©rico simples
    let hash = 0;
    for (let i = 0; i < abaId.length; i++) {
      hash = abaId.charCodeAt(i) + ((hash << 5) - hash);
    }
    // Gera cor pastel
    const h = Math.abs(hash) % 360;
    return `hsl(${h}, 70%, 60%)`;
  }

  let mediaRecorder = null;
  let audioChunks = [];
  let gravando = false;

  function toggleRecording(btn) {
    if (!gravando) {
      startRecording(btn);
    } else {
      stopRecording(btn);
    }
  }

  async function startRecording(btn) {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert('Seu navegador n√£o suporta grava√ß√£o de √°udio.');
      return;
    }
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
      mediaRecorder.ondataavailable = (e) => {
        if (e.data.size > 0) audioChunks.push(e.data);
      };
      mediaRecorder.onstop = () => {
        if (audioChunks.length > 0) {
          const blob = new Blob(audioChunks, { type: 'audio/webm' });
          const url = URL.createObjectURL(blob);
          const mensagens = getMensagensSala();
          mensagens.push({ tipo: 'media', mediaType: 'audio', url, nome: '√Åudio', data: Date.now(), abaId });
          salvarMensagensSala(mensagens);
          renderizarMensagens();
        }
        btn.classList.remove('gravando');
        gravando = false;
      };
      mediaRecorder.start();
      btn.classList.add('gravando');
      gravando = true;
    } catch (err) {
      alert('Erro ao acessar o microfone: ' + err.message);
    }
  }

  function stopRecording(btn) {
    if (mediaRecorder && gravando) {
      mediaRecorder.stop();
      gravando = false;
      btn.classList.remove('gravando');
    }
  }
  window.toggleRecording = toggleRecording;

  // Estilo para bot√£o de grava√ß√£o
  const style = document.createElement('style');
  style.innerHTML = `
  #micBtn.gravando svg {
    animation: pulse 1s infinite;
    stroke: #0BFF8E;
  }
  @keyframes pulse {
    0% { filter: drop-shadow(0 0 0 #0BFF8E); }
    50% { filter: drop-shadow(0 0 8px #0BFF8E); }
    100% { filter: drop-shadow(0 0 0 #0BFF8E); }
  }
  .audio-message {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #181818;
    border-radius: 8px;
    padding: 8px 12px;
    margin-top: 4px;
  }
  .audio-message audio {
    width: 180px;
  }
  `;
  document.head.appendChild(style);

  // Fun√ß√£o para detectar e extrair ID do v√≠deo do YouTube
  function getYouTubeId(url) {
    // Suporta links do tipo youtu.be/xxxx, youtube.com/watch?v=xxxx, youtube.com/embed/xxxx
    const regex = /(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([\w-]{11})/;
    const match = url.match(regex);
    return match ? match[1] : null;
  }

  // Atualiza renderizarMensagens para aplicar cor de borda
  function renderizarMensagens() {
    if (!chatBox) return;
    chatBox.innerHTML = '';
    const mensagens = getMensagensSala();
    mensagens.forEach((msg, idx) => {
      let div = document.createElement('div');
      div.style.position = 'relative';
      if (msg.abaId) {
        div.style.border = `2.5px solid ${corPorAbaId(msg.abaId)}`;
      }
      if (msg.abaId && msg.abaId !== abaId) {
        div.className = 'message bot-message';
      } else {
        div.className = 'message user-message';
      }
      // Se for resposta, mostra o link para a mensagem original
      if (msg.responde !== undefined && mensagens[msg.responde]) {
        const resp = mensagens[msg.responde];
        const respDiv = document.createElement('div');
        respDiv.className = 'resposta-link';
        respDiv.textContent = 'resposta';
        respDiv.style.cursor = 'pointer';
        respDiv.style.fontSize = '12px';
        respDiv.style.color = '#0BFF8E';
        respDiv.style.marginBottom = '2px';
        respDiv.onclick = (e) => {
          destacarMensagem(msg.responde);
        };
        div.appendChild(respDiv);
        // Se o usu√°rio foi respondido, notifica
        if (resp.abaId === abaId && !msg._notificado) {
          notificarUsuario('Voc√™ foi respondido!');
          msg._notificado = true;
          salvarMensagensSala(mensagens);
        }
      }
      if (msg.apagada) {
        if (msg.abaId === abaId) {
          div.textContent = 'Voc√™ apagou esta mensagem';
        } else {
          div.textContent = 'mensagem apagada';
        }
        div.style.fontStyle = 'italic';
        div.style.opacity = '0.7';
      } else if (msg.tipo === 'media') {
        if (msg.mediaType === 'image' && msg.visualizacaoUnica) {
          // Checa se j√° foi vista por esse usu√°rio
          const vistoKey = `img_vista_${msg.data}_${abaId}`;
          const jaViu = sessionStorage.getItem(vistoKey);
          const agora = Date.now();
          if (jaViu) {
            // N√£o mostra mais nada
            return;
          } else if (agora > msg.expiraEm) {
            // Expirada
            div.textContent = 'Imagem expirada';
            div.style.fontStyle = 'italic';
            div.style.opacity = '0.7';
          } else {
            // Mostra box com √≠cone de olho
            const box = document.createElement('div');
            box.style.display = 'flex';
            box.style.alignItems = 'center';
            box.style.justifyContent = 'center';
            box.style.background = '#222';
            box.style.border = '2px solid #0BFF8E';
            box.style.borderRadius = '10px';
            box.style.padding = '18px';
            box.style.cursor = 'pointer';
            box.style.margin = '10px 0';
            box.innerHTML = `
              <svg width="32" height="32" fill="none" stroke="#0BFF8E" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="4"/>
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              </svg>
              <span style="margin-left:10px;">Imagem de visualiza√ß√£o √∫nica</span>
            `;
            box.onclick = () => {
              // Mostra imagem em overlay
              const overlay = document.createElement('div');
              overlay.style.position = 'fixed';
              overlay.style.top = 0;
              overlay.style.left = 0;
              overlay.style.width = '100vw';
              overlay.style.height = '100vh';
              overlay.style.background = 'rgba(0,0,0,0.9)';
              overlay.style.display = 'flex';
              overlay.style.alignItems = 'center';
              overlay.style.justifyContent = 'center';
              overlay.style.zIndex = 9999;
              overlay.onclick = () => {
                overlay.remove();
                sessionStorage.setItem(vistoKey, '1');
                // Remove a mensagem do chat para esse usu√°rio
                div.remove();
              };
              const img = document.createElement('img');
              img.src = msg.url;
              img.style.maxWidth = '90vw';
              img.style.maxHeight = '90vh';
              img.style.borderRadius = '10px';
              overlay.appendChild(img);
              document.body.appendChild(overlay);
            };
            div.appendChild(box);
          }
        } else if (msg.mediaType === 'image') {
          const img = document.createElement('img');
          img.src = msg.url;
          img.alt = msg.nome || '';
          img.style.maxWidth = '250px';
          img.style.borderRadius = '5px';
          img.style.marginTop = '5px';
          img.style.cursor = 'pointer';
          img.onclick = () => window.open(img.src);
          div.appendChild(img);
        } else if (msg.mediaType === 'video') {
          const video = document.createElement('video');
          video.src = msg.url;
          video.controls = true;
          video.style.maxWidth = '250px';
          video.style.borderRadius = '5px';
          video.style.marginTop = '5px';
          div.appendChild(video);
        } else if (msg.mediaType === 'audio') {
          const audioDiv = document.createElement('div');
          audioDiv.className = 'audio-message';
          const audio = document.createElement('audio');
          audio.src = msg.url;
          audio.controls = true;
          audioDiv.appendChild(audio);
          div.appendChild(audioDiv);
        } else {
          const link = document.createElement('a');
          link.href = msg.url;
          link.target = '_blank';
          link.innerText = `üìé ${msg.nome || 'Arquivo'}`;
          link.style.color = '#fff';
          div.appendChild(link);
        }
      } else if (!msg.responde) {
        // Renderiza texto e, se houver link do YouTube, mostra embed
        div.textContent = msg.texto;
        // Procura links do YouTube
        const ytId = getYouTubeId(msg.texto);
        if (ytId) {
          const ytDiv = document.createElement('div');
          ytDiv.style.marginTop = '8px';
          ytDiv.innerHTML = `<iframe width="100%" height="220" src="https://www.youtube.com/embed/${ytId}" frameborder="0" allowfullscreen style="border-radius:10px;"></iframe>`;
          div.appendChild(ytDiv);
        }
      } else {
        // Se for resposta, mostra o texto normalmente ap√≥s o link
        const textoDiv = document.createElement('div');
        textoDiv.textContent = msg.texto;
        // Procura links do YouTube
        const ytId = getYouTubeId(msg.texto);
        if (ytId) {
          const ytDiv = document.createElement('div');
          ytDiv.style.marginTop = '8px';
          ytDiv.innerHTML = `<iframe width="100%" height="220" src="https://www.youtube.com/embed/${ytId}" frameborder="0" allowfullscreen style="border-radius:10px;"></iframe>`;
          textoDiv.appendChild(ytDiv);
        }
        div.appendChild(textoDiv);
      }
      criarMenuMensagem(div, msg, idx);
      chatBox.appendChild(div);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  let ultimaMensagem = 0;

  function enviarMensagem() {
    const agora = Date.now();
    if (agora - ultimaMensagem < 8600) {
      notificarUsuario('Aguarde 8,6 segundos para enviar outra mensagem.');
      return;
    }
    const texto = messageInput.value.trim();
    if (!texto) return;
    const mensagens = getMensagensSala();
    let msg = { texto, tipo: 'user', data: agora, abaId };
    const respIdx = messageInput.getAttribute('data-responde-idx');
    if (respIdx !== null) {
      msg.responde = parseInt(respIdx);
      messageInput.removeAttribute('data-responde-idx');
    }
    mensagens.push(msg);
    salvarMensagensSala(mensagens);
    messageInput.value = '';
    ultimaMensagem = agora;
    renderizarMensagens();
  }
  window.sendMessage = enviarMensagem;

  function handleKeyPress(event) {
    if (event.key === 'Enter') enviarMensagem();
  }
  window.handleKeyPress = handleKeyPress;

  // Responsividade extra para mobile (scroll para baixo ao focar input)
  if (messageInput) {
    messageInput.addEventListener('focus', () => {
      setTimeout(() => {
        chatBox.scrollTop = chatBox.scrollHeight;
      }, 200);
    });
  }

  // Recebe o nome da sala via postMessage
  window.addEventListener('message', (event) => {
    if (event.data && event.data.tituloSala) {
      salaAtual = event.data.tituloSala;
      if (tituloSalaEl) tituloSalaEl.textContent = salaAtual;
      renderizarMensagens();
    }
  });

  // Atualiza o chat a cada 1 segundo
  setInterval(renderizarMensagens, 5670);

  // Inicializa com sala da URL
  renderizarMensagens();

  window.selectFile = function() {
    var fileInput = document.getElementById('fileInput');
    if (fileInput) fileInput.click();
  };

  // Adiciona suporte a envio de m√≠dia
  const fileInput = document.getElementById('fileInput');
  const visualizacaoUnicaCheckbox = document.getElementById('visualizacaoUnica');
  if (fileInput) {
    fileInput.addEventListener('change', function () {
      const file = fileInput.files[0];
      if (!file) return;
      const mensagens = getMensagensSala();
      let msg = { tipo: 'media', data: Date.now(), abaId };
      const fileType = file.type.split('/')[0];
      if (fileType === 'image') {
        msg.mediaType = 'image';
        msg.url = URL.createObjectURL(file);
        msg.nome = file.name;
        msg.visualizacaoUnica = visualizacaoUnicaCheckbox.checked; // <-- aqui
        msg.expiraEm = Date.now() + 60000; // 1 minuto
      } else if (fileType === 'video') {
        msg.mediaType = 'video';
        msg.url = URL.createObjectURL(file);
        msg.nome = file.name;
      } else {
        msg.mediaType = 'file';
        msg.url = URL.createObjectURL(file);
        msg.nome = file.name;
      }
      mensagens.push(msg);
      salvarMensagensSala(mensagens);
      fileInput.value = '';
      renderizarMensagens();
    });
  }

  // Adiciona fun√ß√£o para destacar mensagem
  function destacarMensagem(idx) {
    const msgDivs = chatBox.querySelectorAll('.message');
    if (msgDivs[idx]) {
      msgDivs[idx].classList.add('neon-destaque');
      setTimeout(() => {
        msgDivs[idx].classList.remove('neon-destaque');
      }, 6000);
      msgDivs[idx].scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }

  // Adiciona fun√ß√£o para notificar usu√°rio
  function notificarUsuario(texto) {
    let notif = document.getElementById('notif-resposta');
    if (!notif) {
      notif = document.createElement('div');
      notif.id = 'notif-resposta';
      notif.style.position = 'fixed';
      notif.style.top = '20px';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.background = '#0BFF8E';
      notif.style.color = '#000';
      notif.style.padding = '12px 24px';
      notif.style.borderRadius = '8px';
      notif.style.fontWeight = 'bold';
      notif.style.fontSize = '1.1rem';
      notif.style.zIndex = '9999';
      notif.style.boxShadow = '0 2px 16px #0BFF8E88';
      document.body.appendChild(notif);
    }
    notif.textContent = texto;
    notif.style.display = 'block';
    setTimeout(() => { notif.style.display = 'none'; }, 5000);
  }

  // Adiciona estilo para destaque neon
  const styleNeon = document.createElement('style');
  styleNeon.innerHTML = `
  .neon-destaque {
    box-shadow: 0 0 16px 4px #0BFF8E, 0 0 32px 8px #0BFF8E99;
    border-color: #0BFF8E !important;
    transition: box-shadow 0.3s, border-color 0.3s;
  }
  .resposta-link:hover {
    text-decoration: underline;
  }
  `;
  document.head.appendChild(styleNeon);

// Visualiza√ß√£o √∫nica: bot√£o SVG customizado
(function() {
  const btn = document.getElementById('visualizacaoUnicaBtn');
  const icon = document.getElementById('visualizacaoUnicaIcon');
  const checkbox = document.getElementById('visualizacaoUnica');
  if (!btn || !icon || !checkbox) return;
  // SVGs
  const svgOlhoAberto = `<svg id="visualizacaoUnicaIcon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>`;
  const svgOlhoFechado = `<svg id="visualizacaoUnicaIcon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#0BFF8E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/><path d="M4 4l16 16"/></svg>`;
  function updateIcon() {
    if (checkbox.checked) {
      btn.innerHTML = svgOlhoFechado;
      document.getElementById('visualizacaoUnicaIcon').setAttribute('aria-label', 'Visualiza√ß√£o √∫nica ativada');
    } else {
      btn.innerHTML = svgOlhoAberto;
      document.getElementById('visualizacaoUnicaIcon').setAttribute('aria-label', 'Visualiza√ß√£o √∫nica desativada');
    }
  }
  btn.addEventListener('click', function() {
    checkbox.checked = !checkbox.checked;
    updateIcon();
  });
  btn.addEventListener('keydown', function(e) {
    if (e.key === ' ' || e.key === 'Enter') {
      e.preventDefault();
      checkbox.checked = !checkbox.checked;
      updateIcon();
    }
  });
  // Inicializa
  updateIcon();
})();
</script>
  <script src="/Scripts/Aplica√ß√µes/Chat.js"></script>
  <script defer src="your-script.js"></script>
</body>
</html> 
